<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Web Editor with Monaco + Preview + Console Toggle</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }

    #main-container {
      display: flex;
      flex-direction: row;
      height: 100%;
      width: 100%;
    }

    /* Left panel: editors */
    #editor-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    #tabs {
      display: flex;
      background: #f5f5f5;
      border-bottom: 1px solid #ccc;
    }
    #tabs button {
      flex: 1;
      padding: 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      transition: background 0.2s;
    }
    #tabs button:hover { background: #eee; }
    #tabs button.active {
      background: #fff;
      border-bottom: 2px solid dodgerblue;
    }

    .editor-container {
      flex: 1;
      display: none;
    }
    .editor-container.active {
      display: block;
    }

    /* Right panel: preview + console */
    #right-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    #preview-panel {
      flex: 2;
      position: relative;
    }
    #preview-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }

    /* Console toolbar */
    #console-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #2d2d2d;
      color: #ccc;
      font-family: monospace;
      font-size: 13px;
      padding: 4px 8px;
      border-top: 1px solid #444;
      border-bottom: 1px solid #444;
    }
    #console-toolbar button {
      background: #444;
      color: #eee;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      border-radius: 4px;
      margin-left: 4px;
    }
    #console-toolbar button:hover {
      background: #555;
    }

    #console-panel {
      flex: 1;
      background: #1e1e1e;
      color: #eee;
      font-family: monospace;
      font-size: 13px;
      padding: 8px;
      overflow-y: auto;
      transition: max-height 0.3s ease;
    }

    .console-log    { color: #0f0; }
    .console-warn   { color: #ff0; }
    .console-error  { color: #f55; }
    .console-clear  { color: #888; font-style: italic; }

    /* Gutters for Split.js */
    .gutter {
      background-color: #ddd;
      background-repeat: no-repeat;
      background-position: 50%;
    }
    .gutter.gutter-horizontal {
      cursor: col-resize;
      width: 6px;
    }
    .gutter.gutter-vertical {
      cursor: row-resize;
      height: 6px;
    }

    /* Hidden console state */
    #console-panel.hidden {
      display: none;
    }
    #console-toolbar.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="main-container">
    <!-- Left: Monaco editors -->
    <div id="editor-panel">
      <div id="tabs">
        <button data-tab="html" class="active">HTML</button>
        <button data-tab="css">CSS</button>
        <button data-tab="js">JavaScript</button>
        <button data-tab="ts">TypeScript</button>
      </div>

      <div id="html-editor" class="editor-container active"></div>
      <div id="css-editor" class="editor-container"></div>
      <div id="js-editor" class="editor-container"></div>
      <div id="ts-editor" class="editor-container"></div>
    </div>

    <!-- Right: Preview + Console -->
    <div id="right-panel">
      <div id="preview-panel">
        <iframe id="preview-frame" sandbox="allow-scripts allow-same-origin"></iframe>
      </div>

      <!-- Console toolbar -->
      <div id="console-toolbar">
        <span>Console</span>
        <div>
          <button id="toggle-console-btn">Hide Console</button>
          <button id="clear-console-btn">Clear</button>
        </div>
      </div>

      <div id="console-panel"></div>
    </div>
  </div>

  <!-- Split.js -->
  <script src="https://cdn.jsdelivr.net/npm/split.js@1.6.5/dist/split.min.js"></script>
  <!-- Monaco -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>

  <script>
    let editors = {};
    let rightSplit;
    let consoleVisible = true;
    let previousSizes = [70, 5, 25]; // default preview / toolbar / console

    // Horizontal split: editor | right
    Split(['#editor-panel', '#right-panel'], {
      sizes: [50, 50],
      minSize: 200,
      gutterSize: 6,
      cursor: 'col-resize'
    });

    // Vertical split inside right panel
    rightSplit = Split(['#preview-panel', '#console-toolbar', '#console-panel'], {
      direction: 'vertical',
      sizes: previousSizes,
      minSize: [100, 25, 50],
      gutterSize: 6,
      cursor: 'row-resize'
    });

    // --- Monaco setup ---
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs' } });
    require(['vs/editor/editor.main'], () => {
      editors.html = monaco.editor.create(document.getElementById('html-editor'), {
        value: "<h1>Hello Monaco!</h1>\n<p>Toggle the console below ðŸ‘‡</p>",
        language: 'html',
        theme: 'vs-dark',
        automaticLayout: true
      });

      editors.css = monaco.editor.create(document.getElementById('css-editor'), {
        value: "h1 { color: dodgerblue; }",
        language: 'css',
        theme: 'vs-dark',
        automaticLayout: true
      });

      editors.js = monaco.editor.create(document.getElementById('js-editor'), {
        value: "console.log('JS ready');",
        language: 'javascript',
        theme: 'vs-dark',
        automaticLayout: true
      });

      editors.ts = monaco.editor.create(document.getElementById('ts-editor'), {
        value: "console.log('TS works too!');",
        language: 'typescript',
        theme: 'vs-dark',
        automaticLayout: true
      });

      document.querySelectorAll('#tabs button').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelector('#tabs button.active').classList.remove('active');
          btn.classList.add('active');
          document.querySelector('.editor-container.active').classList.remove('active');
          document.getElementById(btn.dataset.tab + '-editor').classList.add('active');
        });
      });

      const consolePanel = document.getElementById('console-panel');
      const clearBtn = document.getElementById('clear-console-btn');
      const toggleBtn = document.getElementById('toggle-console-btn');
      const toolbar = document.getElementById('console-toolbar');

      function renderValue(val) {
        if (val === null) return createText('null', '#888');
        if (val === undefined) return createText('undefined', '#888');
        const t = typeof val;
        if (t === 'string') return createText(`"${val}"`, '#0ff');
        if (t === 'number' || t === 'boolean') return createText(val, '#fd0');
        if (t === 'function') return createText('[Function]', '#fa0');
        if (Array.isArray(val)) {
          const details = document.createElement('details');
          const summary = document.createElement('summary');
          summary.textContent = `Array(${val.length})`;
          summary.style.color = '#0af';
          details.appendChild(summary);
          const inner = document.createElement('div');
          inner.style.marginLeft = '1em';
          val.forEach((v,i)=>{
            const line = document.createElement('div');
            line.appendChild(createText(i + ': ', '#999'));
            line.appendChild(renderValue(v));
            inner.appendChild(line);
          });
          details.appendChild(inner);
          return details;
        }
        if (t === 'object') {
          const keys = Object.keys(val);
          const details = document.createElement('details');
          const summary = document.createElement('summary');
          summary.textContent = `Object {${keys.length}}`;
          summary.style.color = '#0af';
          details.appendChild(summary);
          const inner = document.createElement('div');
          inner.style.marginLeft = '1em';
          keys.forEach(k=>{
            const line = document.createElement('div');
            line.appendChild(createText(k + ': ', '#999'));
            line.appendChild(renderValue(val[k]));
            inner.appendChild(line);
          });
          details.appendChild(inner);
          return details;
        }
        return createText(String(val), '#eee');
      }

      function createText(text, color) {
        const span = document.createElement('span');
        span.style.color = color;
        span.textContent = text;
        return span;
      }

      function addConsoleMessage(type, values) {
        const line = document.createElement('div');
        line.className = 'console-' + type;
        values.forEach((val,i)=>{
          if (i>0) line.appendChild(document.createTextNode(' '));
          line.appendChild(renderValue(val));
        });
        consolePanel.appendChild(line);
        consolePanel.scrollTop = consolePanel.scrollHeight;
      }

      function clearConsole() {
        consolePanel.innerHTML = '';
        const line = document.createElement('div');
        line.className = 'console-clear';
        line.textContent = '--- Console cleared ---';
        consolePanel.appendChild(line);
      }

      clearBtn.addEventListener('click', clearConsole);

      toggleBtn.addEventListener('click', () => {
        consoleVisible = !consoleVisible;
        if (!consoleVisible) {
          previousSizes = rightSplit.getSizes();
          rightSplit.collapse(2); // collapse console panel
          toolbar.classList.add('hidden');
          consolePanel.classList.add('hidden');
          toggleBtn.textContent = 'Show Console';
        } else {
          toolbar.classList.remove('hidden');
          consolePanel.classList.remove('hidden');
          rightSplit.setSizes(previousSizes);
          toggleBtn.textContent = 'Hide Console';
        }
      });

      // Build & preview
      function updatePreview() {
        clearConsole();
        const html = editors.html.getValue();
        const css = `<style>${editors.css.getValue()}</style>`;
        const js = editors.js.getValue();
        const tsCode = editors.ts.getValue();

        monaco.languages.typescript.getTypeScriptWorker()
          .then(worker => worker(editors.ts.getModel().uri))
          .then(client => client.getEmitOutput(editors.ts.getModel().uri.toString()))
          .then(output => {
            const tsJs = output.outputFiles[0]?.text || "";
            const fullCode = `
              <html>
              <head>${css}</head>
              <body>
                ${html}
                <script>
                  (function() {
                    const send = (type,args)=>parent.postMessage({type,args},'*');
                    console.log = (...a)=>send('log',a);
                    console.warn = (...a)=>send('warn',a);
                    console.error = (...a)=>send('error',a);
                    window.onerror = (msg, src, line, col) => {
                      send('error', [msg + ' (' + line + ':' + col + ')']);
                    };
                    try {
                      ${js}
                      ${tsJs}
                    } catch(e) {
                      console.error(e);
                    }
                  })();
                <\/script>
              </body>
              </html>`;
            document.getElementById('preview-frame').srcdoc = fullCode;
          });
      }

      window.addEventListener('message', e => {
        const { type, args } = e.data;
        if (type && args) addConsoleMessage(type, args);
      });

      function debounce(fn, delay=400){
        let t;
        return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),delay);}
      }

      const debouncedUpdate = debounce(updatePreview);
      Object.values(editors).forEach(ed=>{
        ed.onDidChangeModelContent(debouncedUpdate);
      });

      updatePreview();
    });
  </script>
</body>
</html>
